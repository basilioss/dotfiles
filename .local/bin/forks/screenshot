#!/bin/bash
#
# Screenshot wrapper with maim
# https://github.com/elenapan/dotfiles

SCREENSHOTS_DIR="$HOME/main/library/pictures/screenshots/"
TIMESTAMP="$(date +%Y%m%d_%H%M%S)"
FILENAME="$SCREENSHOTS_DIR/$TIMESTAMP.png"
PHOTO_ICON_PATH="/usr/share/icons/Flat-Remix-Blue-Dark/actions/24/view-preview.svg"

# -u option hides cursor
# -m option changes the compression level
#   -m 3 takes the shot faster but the file size is slightly bigger

if [[ "$1" = "-s" ]]; then
    # Area/window selection.
    notify-send 'Select area to capture.' -i $PHOTO_ICON_PATH
    maim -u -m 3 -s "$FILENAME"
    if [[ "$?" = "0" ]]; then
        notify-send "Screenshot taken." -i $PHOTO_ICON_PATH
    fi
elif [[ "$1" = "-c" ]]; then
    notify-send 'Select area to copy to clipboard.' -i $PHOTO_ICON_PATH
    # Copy selection to clipboard
    #maim -u -m 3 -s | xclip -selection clipboard -t image/png
    maim -u -m 3 -s /tmp/maim_clipboard
    if [[ "$?" = "0" ]]; then
        xclip -selection clipboard -t image/png /tmp/maim_clipboard
        notify-send "Copied selection to clipboard." -i $PHOTO_ICON_PATH
        rm /tmp/maim_clipboard
    fi
elif [[ "$1" = "-b" ]]; then
    # Browse with sxiv
    sxiv "$SCREENSHOTS_DIR" &
elif [[ "$1" = "-e" ]]; then
    # Edit last screenshot with GIMP
    cd $SCREENSHOTS_DIR ; krita "$(ls -t | head -n1)" & \
        notify-send 'Opening last screenshot with Krita'
else
    # Full screenshot
    maim -u -m 3 "$FILENAME"
    notify-send "Screenshot taken." -i $PHOTO_ICON_PATH
fi
