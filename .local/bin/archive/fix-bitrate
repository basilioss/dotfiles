#!/bin/sh

bitrate=$(ffprobe "$1" 2>&1 | grep "Stream #0:0" | awk '{print $9}')

if [ "$bitrate" -gt 245 ] && [ "$bitrate" -ne 256 ]; then
    ffmpeg -i "$1" -vsync 0 -b:a 256k "tmp_$1"
    rm "$1"
    mv "tmp_$1" "$1"
    echo "Audio bitrate have been converted from $bitrate to 256"
elif [ "$bitrate" -gt 180 ] && [ "$bitrate" -lt 246 ] && [ "$bitrate" -ne 192 ]; then
    ffmpeg -i "$1" -vsync 0 -b:a 192k "tmp_$1"
    rm "$1"
    mv "tmp_$1" "$1"
    echo "Audio bitrate have been converted from $bitrate to 192"
elif [ "$bitrate" -gt 150 ] && [ "$bitrate" -lt 181 ] && [ "$bitrate" -ne 160 ]; then
    ffmpeg -i "$1" -vsync 0 -b:a 160k "tmp_$1"
    rm "$1"
    mv "tmp_$1" "$1"
    echo "Audio bitrate have been converted from $bitrate to 160"
elif [ "$bitrate" -lt 151 ] && [ "$bitrate" -ne 128 ]; then
    ffmpeg -i "$1" -vsync 0 -b:a 128k "tmp_$1"
    rm "$1"
    mv "tmp_$1" "$1"
    echo "Audio bitrate have been converted from $bitrate to 128"
else
    echo "Nothing to do"
fi
