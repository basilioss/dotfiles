#!/bin/bash
#
# Description: Search markdown notes with fzf and open the selected one in the default editor
# Usage:
# Dependencies: fzf, bat
# Credits:
# Github:

# Set with the flags "-e", "-u","-o pipefail" cause the script to fail
# if certain things happen, which is a good thing.  Otherwise, we can
# get hidden bugs that are hard to discover.
set -euo pipefail

# Specify path to the folder
vaultpath="/home/basilios/hdd/notes/"

vault_path_length=$(echo "$vaultpath" | wc -c | tr -d " ")

# Find markdown files, exclude hidden folders
notes="$(find ${vaultpath} -not -path '*/.*' -iname "*.md")"

choice=$(echo "${notes[@]}" | \
       # Remove vault path before filename
       cut -c"$vault_path_length"- | \
       # Remove ".md" at the end
       sed 's/.md//g' | \
       fzf --preview "bat --color=always --style=snip --wrap=character --terminal-width=35 --line-range=:80 \"$vaultpath\"{}.md")

if [ "$choice" ]; then
    xdg-open "${vaultpath}${choice}.md"
else
    echo "Program terminated."
fi
