#!/bin/sh
#
# Select text on screen to copy it to the clipboard
# https://github.com/basilioss/dotfiles

menu="dmenu -i"
# screenshot="magick import"
screenshot="maim --hidecursor --nodrag -s"

ocr() {
  # Declare variables
  dir="$HOME/.cache"
  date="$(date +%s)"
  img="${dir}/img-${date}.png"
  output="${dir}/out-${date}"
  # Wait till the menu animation is finished (by picom)
  sleep 0.3
  # Show pointer if it was hidden (by unclutter)
  xdotool mousemove_relative 1 0
  # Take screenshot
  eval "${screenshot}" "${img}"
  # Screenshot to txt
  tesseract "${img}" "${output}" -l "$1"
  # Txt to clipboard
  tr "\n" " " < "${output}.txt" | xclip -selection clipboard
  # Remove screenshot and txt
  rm "${img}" "${output}.txt"
}

main() {
  language="$(printf "%b" "Ukrainian\nEnglish\nRussian" | ${menu})"

  case "${language}" in
    Ukrainian) ocr ukr ;;
    English) ocr eng ;;
    Russian) ocr rus ;;
  esac
}

main "$@"
